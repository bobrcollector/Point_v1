<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.EventDetailsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Point_v1.Converters"
             Title="Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1C1C1E}">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- ÐšÐžÐœÐŸÐÐšÐ¢ÐÐÐ¯ Ð¨ÐÐŸÐšÐ ÐšÐÐš Ð’ ModeratorDashboardPage -->
        <Frame Grid.Row="0"
               BackgroundColor="#512BD4"
               Padding="15"
               CornerRadius="0"
               HasShadow="True">

            <Grid ColumnDefinitions="Auto,*,Auto">
                <Button Grid.Column="0"
                        Text="â†"
                        Command="{Binding GoBackCommand}"
                        Style="{StaticResource IconButton}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="18"
                        WidthRequest="44"
                        HeightRequest="44"/>

                <Label Grid.Column="1"
                       Text="Ð”ÐµÑ‚Ð°Ð»Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ"
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Grid>
        </Frame>

        <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="0">

                <!-- ÐšÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ -->
                <Frame Margin="15,16,15,0"
                       Padding="0"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                    <VerticalStackLayout Spacing="0">
                        <BoxView BackgroundColor="#512BD4"
                                 HeightRequest="10"
                                 CornerRadius="15,15,0,0"/>

                        <VerticalStackLayout Spacing="16" Padding="20">

                            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
                            <VerticalStackLayout Spacing="10">
                                <Label Text="{Binding Event.Title}" 
                                       FontSize="22" 
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       LineBreakMode="WordWrap"/>

                                <Frame BackgroundColor="#DFD8F7"
                                       Padding="8,4"
                                       CornerRadius="10"
                                       HasShadow="False"
                                       HorizontalOptions="Start">
                                    <Label Text="{Binding Event.CategoryId}" 
                                           FontSize="12"
                                           FontAttributes="Bold"
                                           TextColor="#512BD4"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ -->
                            <VerticalStackLayout Spacing="12">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Label Grid.Column="0" 
                                           Text="ðŸ“…" 
                                           FontSize="16"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Event.DetailedDateDisplay}" 
                                           FontSize="16"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                           Margin="10,0,0,0"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*">
                                    <Label Grid.Column="0" 
                                           Text="ðŸ“" 
                                           FontSize="16"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Event.Address}" 
                                           FontSize="16"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                           LineBreakMode="WordWrap"
                                           Margin="10,0,0,0"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Label Grid.Column="0" 
                                       Text="ðŸ‘¥" 
                                       FontSize="16"
                                       VerticalOptions="Center"/>
                                    <Label Grid.Column="1" 
                                       Text="{Binding Event.ParticipantsDisplay}" 
                                       FontSize="16"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       Margin="10,0,0,0"/>

                                    <Label Grid.Column="2" 
                                       Text="âœ“ Ð£Ñ‡Ð°ÑÑ‚Ð²ÑƒÐµÑ‚Ðµ"
                                       FontSize="12"
                                       TextColor="#4CAF50"
                                       FontAttributes="Bold"
                                       IsVisible="{Binding IsParticipating}"/>
                                </Grid>
                            </VerticalStackLayout>

                            <!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ Ð±Ð°Ñ€ -->
                            <VerticalStackLayout Spacing="8" 
                                                IsVisible="{Binding Event.IsFull, Converter={converters:InverseBoolConverter}}">
                                <ProgressBar Progress="{Binding Event.ParticipationProgress}"
                                             ProgressColor="#512BD4"
                                             BackgroundColor="#E0E0E0"
                                             HeightRequest="6"/>
                                <Label Text="{Binding Event.ParticipantsDisplay}" 
                                       FontSize="12"
                                       TextColor="Gray"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>

                            <!-- Ð—Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ -->
                            <Frame IsVisible="{Binding Event.IsFull}"
                                   BackgroundColor="#FFEBEE"
                                   Padding="12"
                                   CornerRadius="12"
                                   HasShadow="False">
                                <Label Text="ðŸš« Ð’ÑÐµ Ð¼ÐµÑÑ‚Ð° Ð·Ð°Ð½ÑÑ‚Ñ‹" 
                                       TextColor="#D32F2F" 
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"/>
                            </Frame>

                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ -->
                <Frame Margin="15,12,15,0"
                       Padding="20"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                    <VerticalStackLayout Spacing="12">
                        <Label Text="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" 
                               Style="{StaticResource Heading3}"/>

                        <Label Text="{Binding Event.Description}" 
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#333333, Dark=#CCCCCC}"
                               LineBreakMode="WordWrap"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- ÐžÑ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ -->
                <Frame Margin="15,12,15,0"
                       Padding="20"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                    <VerticalStackLayout Spacing="12">
                        <Label Text="ÐžÑ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ‚Ð¾Ñ€" 
                               Style="{StaticResource Heading3}"/>

                        <Grid ColumnDefinitions="Auto,*">
                            <Frame Grid.Column="0"
                                   BackgroundColor="#512BD4"
                                   Padding="0"
                                   CornerRadius="25"
                                   HeightRequest="50"
                                   WidthRequest="50"
                                   HorizontalOptions="Start">
                                <Label Text="ðŸ‘¤" 
                                       FontSize="16"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       TextColor="White"/>
                            </Frame>

                            <VerticalStackLayout Grid.Column="1" 
                                               Spacing="4"
                                               VerticalOptions="Center"
                                               Margin="12,0,0,0">
                                <Label Text="{Binding Event.CreatorName}" 
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                                <Label Text="ÐžÑ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ‚Ð¾Ñ€ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ" 
                                       FontSize="12"
                                       TextColor="Gray"/>
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- ÐŸÐ¾Ð»Ñ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² Ñ€ÐµÐ¶Ð¸Ð¼Ðµ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ) -->
                <Frame Margin="15,12,15,0"
                       Padding="20"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                       IsVisible="{Binding IsEditing}">

                    <VerticalStackLayout Spacing="12">
                        <Label Text="Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ" 
                               Style="{StaticResource Heading3}"/>

                        <!-- ÐŸÐ¾Ð»Ðµ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ" 
                                   Style="{StaticResource FormLabel}"/>
                            <Entry Text="{Binding EditTitle}"/>
                        </VerticalStackLayout>

                        <!-- ÐŸÐ¾Ð»Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ñ -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" 
                                   Style="{StaticResource FormLabel}"/>
                            <Editor Text="{Binding EditDescription}"
                                    HeightRequest="100"
                                    AutoSize="TextChanges"/>
                        </VerticalStackLayout>

                        <!-- ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² -->
                        <VerticalStackLayout Spacing="8">
                            <Label Text="ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²" 
                                   Style="{StaticResource FormLabel}"/>
                            <Stepper Value="{Binding EditMaxParticipants}"
                                     Minimum="2"
                                     Maximum="50"
                                     Increment="1"/>
                            <Label Text="{Binding EditMaxParticipants, StringFormat='{0} ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²'}"
                                   FontSize="14"
                                   TextColor="#512BD4"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>

        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
        <Frame Grid.Row="2"
               BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}"
               Padding="15,12"
               CornerRadius="0"
               HasShadow="True">

            <VerticalStackLayout Spacing="10">
                <!-- Ð ÐµÐ¶Ð¸Ð¼ Ð³Ð¾ÑÑ‚Ñ -->
                <Button Text="Ð’Ð¾Ð¹Ð´Ð¸Ñ‚Ðµ, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÑ‡Ð°ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ"
                        Command="{Binding GoToLoginCommand}"
                        IsVisible="{Binding IsGuestMode}"/>

                <!-- Ð ÐµÐ¶Ð¸Ð¼ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ñ Ñ ÐºÐ½Ð¾Ð¿ÐºÐ¾Ð¹ Ð¶Ð°Ð»Ð¾Ð±Ñ‹ -->
                <Grid ColumnDefinitions="*,Auto" 
                      ColumnSpacing="10"
                      IsVisible="{Binding CanParticipate}">

                    <Button Grid.Column="0"
                            Text="{Binding ParticipationButtonText}"
                            Command="{Binding ToggleParticipationCommand}"
                            BackgroundColor="{Binding ParticipationButtonColor}"
                            TextColor="White"/>

                    <Button Grid.Column="1"
                            Text="ðŸš¨"
                            Command="{Binding ReportEventCommand}"
                            Style="{StaticResource OutlineButton}"
                            TextColor="#D32F2F"
                            BorderColor="#D32F2F"
                            WidthRequest="48"/>
                </Grid>

                <!-- Ð ÐµÐ¶Ð¸Ð¼ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ‚Ð¾Ñ€Ð° (Ð¿Ñ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€) -->
                <Grid ColumnDefinitions="*,*" 
                      ColumnSpacing="10"
                      IsVisible="{Binding ShowOrganizerButtons}">
                    <Button Grid.Column="0"
                            Text="âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                            Command="{Binding EditEventCommand}"
                            BackgroundColor="#FFA000"
                            TextColor="White"/>

                    <Button Grid.Column="1"
                            Text="ðŸ—‘ï¸ Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ"
                            Command="{Binding DeleteEventCommand}"
                            BackgroundColor="#D32F2F"
                            TextColor="White"/>
                </Grid>

                <!-- Ð ÐµÐ¶Ð¸Ð¼ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ‚Ð¾Ñ€Ð° (Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ) -->
                <Grid ColumnDefinitions="*,*" 
                      ColumnSpacing="10"
                      IsVisible="{Binding IsEditing}">
                    <Button Grid.Column="0"
                            Text="âŒ ÐžÑ‚Ð¼ÐµÐ½Ð°"
                            Command="{Binding CancelEditCommand}"
                            Style="{StaticResource OutlineButton}"/>

                    <Button Grid.Column="1"
                            Text="ðŸ’¾ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ"
                            Command="{Binding SaveEditCommand}"
                            BackgroundColor="#4CAF50"
                            TextColor="White"/>
                </Grid>
            </VerticalStackLayout>
        </Frame>

        <!-- Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° -->
        <ActivityIndicator Grid.Row="1"
                         IsVisible="{Binding IsLoading}"
                         IsRunning="{Binding IsLoading}"
                         Color="#512BD4"
                         HorizontalOptions="Center"
                         VerticalOptions="Center"/>

    </Grid>
</ContentPage>