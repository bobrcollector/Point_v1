<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.EventDetailsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Point_v1.Converters"
             Title="Событие"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1C1C1E}">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Шапка -->
        <Frame Grid.Row="0"
               BackgroundColor="#512BD4"
               Padding="15,50,15,20"
               CornerRadius="0"
               HasShadow="True">

            <Grid ColumnDefinitions="Auto,*,Auto">
                <Button Grid.Column="0"
                        Text="←"
                        Command="{Binding GoBackCommand}"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="18"
                        WidthRequest="40"
                        HeightRequest="40"/>

                <Label Grid.Column="1"
                       Text="Детали события"
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Grid>
        </Frame>
      
        <!-- Контент -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="0">

                <!-- Карточка события -->
                <Frame Margin="20,20,20,0"
                       Padding="0"
                       CornerRadius="20"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                    <VerticalStackLayout Spacing="0">
                        <BoxView BackgroundColor="#512BD4"
                                 HeightRequest="10"
                                 CornerRadius="20,20,0,0"/>

                        <VerticalStackLayout Spacing="20" Padding="25">

                            <!-- Заголовок -->
                            <VerticalStackLayout Spacing="10">
                                <Label Text="{Binding Event.Title}" 
                                       FontSize="24" 
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                       LineBreakMode="WordWrap"/>

                                <Frame BackgroundColor="#DFD8F7"
                                       Padding="10,6"
                                       CornerRadius="8"
                                       HasShadow="False"
                                       HorizontalOptions="Start">
                                    <Label Text="{Binding Event.CategoryId}" 
                                           FontSize="12"
                                           FontAttributes="Bold"
                                           TextColor="#512BD4"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Информация -->
                            <VerticalStackLayout Spacing="15">
                                <Grid ColumnDefinitions="Auto,*">
                                    <Label Grid.Column="0" 
                                           Text="📅" 
                                           FontSize="16"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Event.DetailedDateDisplay}" 
                                           FontSize="16"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                           Margin="10,0,0,0"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*">
                                    <Label Grid.Column="0" 
                                           Text="📍" 
                                           FontSize="16"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Event.Address}" 
                                           FontSize="16"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                           LineBreakMode="WordWrap"
                                           Margin="10,0,0,0"/>
                                </Grid>

                                <Grid ColumnDefinitions="Auto,*,Auto">
                                    <Label Grid.Column="0" 
                                           Text="👥" 
                                           FontSize="16"
                                           VerticalOptions="Center"/>
                                    <Label Grid.Column="1" 
                                           Text="{Binding Event.ParticipantsDisplay}" 
                                           FontSize="16"
                                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                           Margin="10,0,0,0"/>

                                    <Label Grid.Column="2" 
                                           Text="{Binding IsParticipating, Converter={x:Static converters:InverseBoolConverter}, ConverterParameter='Вы участвуете'}" 
                                           FontSize="14"
                                           TextColor="#512BD4"
                                           FontAttributes="Bold"
                                           IsVisible="{Binding IsAuthenticated}"/>
                                </Grid>
                            </VerticalStackLayout>


                            <!-- Прогресс бар -->
                            <VerticalStackLayout Spacing="8" 
                                                IsVisible="{Binding Event.IsFull, Converter={x:Static converters:InverseBoolConverter}}">
                                <ProgressBar Progress="{Binding Event.ParticipationProgress}"
                                             ProgressColor="#512BD4"
                                             BackgroundColor="#E0E0E0"
                                             HeightRequest="6"/>
                                <Label Text="{Binding Event.ParticipantsDisplay}" 
                                       FontSize="12"
                                       TextColor="Gray"
                                       HorizontalOptions="Center"/>
                            </VerticalStackLayout>

                            <!-- Заполнено -->
                            <Frame IsVisible="{Binding Event.IsFull}"
                                   BackgroundColor="#FFE0E0"
                                   Padding="15"
                                   CornerRadius="10"
                                   HasShadow="False">
                                <Label Text="🚫 Все места заняты" 
                                       TextColor="#D32F2F" 
                                       FontSize="14"
                                       FontAttributes="Bold"
                                       HorizontalOptions="Center"/>
                                
                            </Frame>

                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>
                

                <!-- Описание -->
                <Frame Margin="20,15,20,0"
                       Padding="25"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                    <VerticalStackLayout Spacing="15">
                        <Label Text="Описание" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=Black, Dark=White}"/>

                        <Label Text="{Binding Event.Description}" 
                               FontSize="16"
                               TextColor="{AppThemeBinding Light=#333333, Dark=#CCCCCC}"
                               LineBreakMode="WordWrap"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Организатор -->
                <Frame Margin="20,15,20,0"
                       Padding="25"
                       CornerRadius="15"
                       HasShadow="True"
                       BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                    <VerticalStackLayout Spacing="15">
                        <Label Text="Организатор" 
                               FontSize="18" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=Black, Dark=White}"/>

                        <Grid ColumnDefinitions="Auto,*">
                            <Frame Grid.Column="0"
                                   BackgroundColor="#512BD4"
                                   Padding="15"
                                   CornerRadius="25"
                                   HeightRequest="50"
                                   WidthRequest="50"
                                   HorizontalOptions="Start">
                                <Label Text="👤" 
                                       FontSize="16"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"
                                       TextColor="White"/>
                            </Frame>

                            <VerticalStackLayout Grid.Column="1" 
                                               Spacing="5"
                                               VerticalOptions="Center"
                                               Margin="15,0,0,0">
                                <Label Text="{Binding Event.CreatorName}" 
                                       FontSize="16"
                                       FontAttributes="Bold"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                                <Label Text="Организатор события" 
                                       FontSize="14"
                                       TextColor="Gray"/>
                            </VerticalStackLayout>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Кнопки -->
        <Frame Grid.Row="2"
               BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}"
               Padding="20,15"
               CornerRadius="0"
               HasShadow="True">

            <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                <Button Grid.Column="0" 
                        Grid.ColumnSpan="2"
                        Text="Войдите, чтобы участвовать"
                        Command="{Binding GoToLoginCommand}"
                        BackgroundColor="#512BD4"
                        TextColor="White"
                        FontSize="16"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        CornerRadius="10"
                        IsVisible="{Binding IsGuestMode}"/>

                <Button Grid.Column="0" 
                        Text="{Binding ParticipationButtonText}"
                        Command="{Binding ToggleParticipationCommand}"
                        BackgroundColor="{Binding ParticipationButtonColor}"
                        TextColor="White"
                        FontSize="16"
                        FontAttributes="Bold"
                        HeightRequest="50"
                        CornerRadius="10"
                        IsVisible="{Binding IsAuthenticated}"/>

                <Button Grid.Column="1" 
                        Text="💬 Чат"
                        Command="{Binding OpenChatCommand}"
                        BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#444444}"
                        TextColor="{AppThemeBinding Light=#333333, Dark=White}"
                        FontSize="16"
                        HeightRequest="50"
                        CornerRadius="10"
                        IsVisible="{Binding IsAuthenticated}"/>

            </Grid>
        </Frame>

        <!-- Загрузка -->
        <ActivityIndicator Grid.Row="1"
                         IsVisible="{Binding IsLoading}"
                         IsRunning="{Binding IsLoading}"
                         Color="#512BD4"
                         HorizontalOptions="Center"
                         VerticalOptions="Center"/>

    </Grid>
</ContentPage>