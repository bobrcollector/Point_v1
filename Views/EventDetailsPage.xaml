<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.EventDetailsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Событие">

    <ScrollView>
        <Grid RowDefinitions="Auto,*,Auto" RowSpacing="0">

            <!-- Карточка события -->
            <Frame Grid.Row="0" 
                   Margin="15" 
                   Padding="20" 
                   CornerRadius="15" 
                   HasShadow="True"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}">

                <VerticalStackLayout Spacing="15">

                    <!-- Заголовок и дата -->
                    <Label Text="{Binding Event.Title}" 
                           FontSize="22" 
                           FontAttributes="Bold"
                           LineBreakMode="WordWrap"/>

                    <Frame BackgroundColor="{StaticResource Secondary}"
                           Padding="10,5"
                           CornerRadius="8"
                           HasShadow="False"
                           HorizontalOptions="Start">
                        <Label Text="{Binding Event.CategoryId}" 
                               FontSize="12"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Primary}"/>
                    </Frame>

                    <!-- Дата и время -->
                    <Grid ColumnDefinitions="Auto,*">
                        <Label Grid.Column="0" Text="📅" FontSize="16"/>
                        <Label Grid.Column="1" 
                               Text="{Binding Event.EventDate, StringFormat='{0:dd.MM.yyyy HH:mm}'}" 
                               FontSize="16"
                               Margin="10,0,0,0"/>
                    </Grid>

                    <!-- Местоположение -->
                    <Grid ColumnDefinitions="Auto,*">
                        <Label Grid.Column="0" Text="📍" FontSize="16"/>
                        <Label Grid.Column="1" 
                               Text="{Binding Event.Address}" 
                               FontSize="16"
                               LineBreakMode="WordWrap"
                               Margin="10,0,0,0"/>
                    </Grid>

                    <!-- Участники -->
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Label Grid.Column="0" Text="👥" FontSize="16"/>
                        <Label Grid.Column="1" 
                               Text="{Binding ParticipantsCount, StringFormat='{0} участников'}" 
                               FontSize="16"
                               Margin="10,0,0,0"/>
                        <Label Grid.Column="2" 
                               Text="{Binding IsParticipating, Converter={x:Static converters:InverseBoolConverter}, ConverterParameter='Вы участвуете'}" 
                               FontSize="14"
                               TextColor="{StaticResource Primary}"
                               FontAttributes="Bold"
                               IsVisible="{Binding IsAuthenticated}"/>
                    </Grid>

                </VerticalStackLayout>
            </Frame>

            <!-- Описание -->
            <Frame Grid.Row="1" 
                   Margin="15,0,15,15" 
                   Padding="20" 
                   CornerRadius="15" 
                   HasShadow="True"
                   BackgroundColor="{AppThemeBinding Light=White, Dark=#1C1C1E}">

                <VerticalStackLayout Spacing="10">
                    <Label Text="Описание" 
                           FontSize="18" 
                           FontAttributes="Bold"/>

                    <Label Text="{Binding Event.Description}" 
                           FontSize="16"
                           LineBreakMode="WordWrap"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Кнопки действий -->
            <Grid Grid.Row="2" 
                  ColumnDefinitions="*,*" 
                  ColumnSpacing="10" 
                  Padding="15"
                  BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#000000}">

                <!-- Для гостей -->
                <Button Grid.Column="0" 
                        Grid.ColumnSpan="2"
                        Text="Войдите, чтобы участвовать"
                        Command="{Binding GoToLoginCommand}"
                        BackgroundColor="{StaticResource Primary}"
                        IsVisible="{Binding IsGuestMode}"/>

                <!-- Для авторизованных -->
                <Button Grid.Column="0" 
                        Text="{Binding ParticipationButtonText}"
                        Command="{Binding ToggleParticipationCommand}"
                        BackgroundColor="{Binding ParticipationButtonColor}"
                        IsVisible="{Binding IsAuthenticated}"/>

                <Button Grid.Column="1" 
                        Text="Чат события"
                        Command="{Binding OpenChatCommand}"
                        BackgroundColor="{StaticResource Secondary}"
                        TextColor="{StaticResource Primary}"
                        IsVisible="{Binding IsAuthenticated}"/>
            </Grid>

        </Grid>
    </ScrollView>
</ContentPage>