<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.SearchPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1C1C1E}">

    <Grid RowDefinitions="Auto,Auto,*,Auto">

        <!-- Ð¨Ð°Ð¿ÐºÐ° -->
        <Frame Grid.Row="0"
               BackgroundColor="#512BD4"
               Padding="15,50,15,20"
               CornerRadius="0"
               HasShadow="True">

            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ° Ð½Ð°Ð·Ð°Ð´ -->
                <Button Grid.Column="0"
                        Text="â†"
                        Clicked="OnBackButtonClicked"
                        BackgroundColor="Transparent"
                        TextColor="White"
                        FontSize="18"
                        WidthRequest="40"
                        HeightRequest="40"/>

                <Label Grid.Column="1"
                       Text="ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹"
                       TextColor="White"
                       FontSize="18"
                       FontAttributes="Bold"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </Grid>
        </Frame>

        <!-- ÐžÑÑ‚Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð´ Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ -->
        <Frame Grid.Row="1"
               Margin="10"
               Padding="15"
               CornerRadius="15"
               HasShadow="True"
               BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

            <VerticalStackLayout Spacing="15">

                <!-- ÐŸÐ¾Ð¸ÑÐºÐ¾Ð²Ð°Ñ ÑÑ‚Ñ€Ð¾ÐºÐ° -->
                <Grid ColumnDefinitions="*,Auto">
                    <Entry Grid.Column="0"
                           Placeholder="ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹..."
                           Text="{Binding SearchText}"
                           BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                           HeightRequest="45"/>

                    <Button Grid.Column="1"
                            Text="ðŸ”"
                            Command="{Binding SearchCommand}"
                            BackgroundColor="#512BD4"
                            TextColor="White"
                            WidthRequest="50"
                            HeightRequest="45"
                            Margin="10,0,0,0"
                            CornerRadius="8"/>
                </Grid>

                <!-- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ -->
                <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">

                    <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ -->
                    <Picker Grid.Column="0"
                            Title="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ"
                            ItemsSource="{Binding AvailableCategories}"
                            SelectedItem="{Binding SelectedCategory}"
                            BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                            HeightRequest="45"/>

                    <!-- Ð”Ð°Ñ‚Ð° -->
                    <DatePicker Grid.Column="1"
                                Date="{Binding SelectedDate}"
                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                                HeightRequest="45"/>

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐ±Ñ€Ð¾ÑÐ° -->
                    <Button Grid.Column="2"
                            Text="ðŸ§¹"
                            Command="{Binding ClearFiltersCommand}"
                            BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#444}"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                            WidthRequest="45"
                            HeightRequest="45"
                            CornerRadius="8"/>
                </Grid>
            </VerticalStackLayout>
        </Frame>

        <!-- Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹ Ð¿Ð¾Ð¸ÑÐºÐ° -->
        <CollectionView Grid.Row="2" 
                        ItemsSource="{Binding SearchResults}"
                        SelectionMode="None">

            <CollectionView.EmptyView>
                <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="15">
                    <Label Text="ðŸ”" FontSize="40" HorizontalOptions="Center"/>
                    <Label Text="ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð¿Ð¾Ð¸ÑÐº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹" 
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>
                    <Label Text="Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð²ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð²Ñ‹ÑˆÐµ" 
                           FontSize="14"
                           TextColor="Gray"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="15,5">
                        <Frame Padding="15" CornerRadius="15" HasShadow="True"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                            <!-- Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ GestureRecognizer Ð´Ð»Ñ ÐºÐ»Ð¸ÐºÐ°Ð±ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ -->
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ViewEventDetailsCommand}"
                                    CommandParameter="{Binding Id}" />
                            </Frame.GestureRecognizers>

                            <VerticalStackLayout Spacing="10">
                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="{Binding Title}" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>
                                    <Label Grid.Column="1"
                                           Text="{Binding DateDisplay}" 
                                           FontSize="12"
                                           TextColor="Gray"/>
                                </Grid>

                                <Label Text="{Binding ShortDescription}" 
                                       FontSize="14"
                                       LineBreakMode="TailTruncation"
                                       MaxLines="2"/>

                                <Grid ColumnDefinitions="*,Auto">
                                    <Label Grid.Column="0"
                                           Text="{Binding Address}" 
                                           FontSize="12"
                                           TextColor="Gray"
                                           LineBreakMode="TailTruncation"/>
                                    <Label Grid.Column="1"
                                           Text="{Binding ParticipantsCount, StringFormat='{0} ðŸŽ¯'}" 
                                           FontSize="12"
                                           TextColor="Gray"/>
                                </Grid>

                                <Frame BackgroundColor="#DFD8F7"
                                       Padding="8,4"
                                       CornerRadius="8"
                                       HasShadow="False"
                                       HorizontalOptions="Start">
                                    <Label Text="{Binding CategoryId}" 
                                           FontSize="12"
                                           TextColor="#512BD4"/>
                                </Frame>
                            </VerticalStackLayout>
                        </Frame>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>