<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.MyEventsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Point_v1.Models"
             xmlns:converters="clr-namespace:Point_v1.Converters"
             Title="ÐœÐ¾Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ">

    <ContentPage.Resources>
        <!-- Ð Ð•Ð“Ð˜Ð¡Ð¢Ð Ð˜Ð Ð£Ð•Ðœ Ð’Ð¡Ð• ÐšÐžÐÐ’Ð•Ð Ð¢Ð•Ð Ð« -->
        <converters:TabColorConverter x:Key="TabColorConverter" />
        <converters:TabTextColorConverter x:Key="TabTextColorConverter" />
        <converters:ShowActionsConverter x:Key="ShowActionsConverter" />
        <converters:ShowEditButtonConverter x:Key="ShowEditButtonConverter" />
        <converters:ShowLeaveButtonConverter x:Key="ShowLeaveButtonConverter" />
        <converters:NegativeBooleanConverter x:Key="NegativeBooleanConverter" />
        <converters:ShowArchiveInfoConverter x:Key="ShowArchiveInfoConverter" />
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Ð’ÐºÐ»Ð°Ð´ÐºÐ¸ (ÐŸÐžÐœÐ•ÐÐ¯Ð›Ð˜ ÐœÐ•Ð¡Ð¢ÐÐœÐ˜ - ÑÐ½Ð°Ñ‡Ð°Ð»Ð° "Ð£Ñ‡Ð°ÑÑ‚Ð²ÑƒÑŽ", Ð¿Ð¾Ñ‚Ð¾Ð¼ "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ") -->
        <Grid Grid.Row="0" 
              ColumnDefinitions="*,*,*"
              BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#3A3A3A}"
              HeightRequest="45"
              Margin="10,10,10,5">

            <!-- Ð¯ ÑƒÑ‡Ð°ÑÑ‚Ð²ÑƒÑŽ (Ð¢Ð•ÐŸÐ•Ð Ð¬ ÐŸÐ•Ð Ð’ÐÐ¯ Ð’ÐšÐ›ÐÐ”ÐšÐ) -->
            <Frame Grid.Column="0"
                   BackgroundColor="{Binding SelectedTab, Converter={x:StaticResource TabColorConverter}, ConverterParameter=Participating}"
                   CornerRadius="8"
                   HasShadow="False"
                   Padding="0"
                   Margin="2">
                <Button Text="Ð£Ñ‡Ð°ÑÑ‚Ð²ÑƒÑŽ" 
                        Command="{Binding SwitchTabCommand}"
                        CommandParameter="Participating"
                        BackgroundColor="Transparent"
                        TextColor="{Binding SelectedTab, Converter={x:StaticResource TabTextColorConverter}, ConverterParameter=Participating}"
                        FontSize="12"
                        HeightRequest="35"/>
            </Frame>

            <!-- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¼Ð½Ð¾Ð¹ (Ð¢Ð•ÐŸÐ•Ð Ð¬ Ð’Ð¢ÐžÐ ÐÐ¯ Ð’ÐšÐ›ÐÐ”ÐšÐ) -->
            <Frame Grid.Column="1"
                   BackgroundColor="{Binding SelectedTab, Converter={x:StaticResource TabColorConverter}, ConverterParameter=Created}"
                   CornerRadius="8"
                   HasShadow="False"
                   Padding="0"
                   Margin="2">
                <Button Text="Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ðµ" 
                        Command="{Binding SwitchTabCommand}"
                        CommandParameter="Created"
                        BackgroundColor="Transparent"
                        TextColor="{Binding SelectedTab, Converter={x:StaticResource TabTextColorConverter}, ConverterParameter=Created}"
                        FontSize="12"
                        HeightRequest="35"/>
            </Frame>

            <!-- ÐÑ€Ñ…Ð¸Ð² -->
            <Frame Grid.Column="2"
                   BackgroundColor="{Binding SelectedTab, Converter={x:StaticResource TabColorConverter}, ConverterParameter=Archived}"
                   CornerRadius="8"
                   HasShadow="False"
                   Padding="0"
                   Margin="2">
                <Button Text="ÐÑ€Ñ…Ð¸Ð²" 
                        Command="{Binding SwitchTabCommand}"
                        CommandParameter="Archived"
                        BackgroundColor="Transparent"
                        TextColor="{Binding SelectedTab, Converter={x:StaticResource TabTextColorConverter}, ConverterParameter=Archived}"
                        FontSize="12"
                        HeightRequest="35"/>
            </Frame>
        </Grid>

        <!-- Ð¡Ð¿Ð¸ÑÐ¾Ðº ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding LoadEventsCommand}"
                     IsRefreshing="{Binding IsLoading}">

            <CollectionView ItemsSource="{Binding CurrentEvents}"
                            SelectionMode="None">

                <CollectionView.EmptyView>
                    <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="15" Margin="20">
                        <Label Text="ðŸ“…" FontSize="40" HorizontalOptions="Center"/>
                        <Label Text="{Binding EmptyViewMessage}" 
                               FontSize="16"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <!-- Ð¨Ð°Ð±Ð»Ð¾Ð½ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ -->
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Event">
                        <Grid Padding="15,8">
                            <Frame Padding="15" 
                                   CornerRadius="15" 
                                   HasShadow="True"
                                   BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">

                                <Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" 
                                      ColumnDefinitions="*,Auto"
                                      RowSpacing="8">

                                    <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð¸ Ð´Ð°Ñ‚Ð° -->
                                    <Label Grid.Row="0" Grid.Column="0"
                                           Text="{Binding Title}" 
                                           FontSize="16" 
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>

                                    <Label Grid.Row="0" Grid.Column="1"
                                           Text="{Binding DateDisplay}" 
                                           FontSize="12"
                                           TextColor="Gray"/>

                                    <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ -->
                                    <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding ShortDescription}" 
                                           FontSize="14"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2"/>

                                    <!-- ÐÐ´Ñ€ÐµÑ -->
                                    <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding Address}" 
                                           FontSize="12"
                                           TextColor="Gray"
                                           LineBreakMode="TailTruncation"/>

                                    <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ð¸ Ð¼ÐµÑ‚ÐºÐ° "ÐœÐ¾Ñ‘ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ" -->
                                    <Grid Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                                          ColumnDefinitions="*,Auto">

                                        <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ -->
                                        <Frame Grid.Column="0"
                                               BackgroundColor="#DFD8F7"
                                               Padding="8,4"
                                               CornerRadius="8"
                                               HasShadow="False"
                                               HorizontalOptions="Start">
                                            <Label Text="{Binding CategoryId}" 
                                                   FontSize="12"
                                                   TextColor="#512BD4"/>
                                        </Frame>

                                        <!-- ÐœÐµÑ‚ÐºÐ° "ÐœÐ¾Ñ‘ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ" -->
                                        <Frame Grid.Column="1"
                                               BackgroundColor="#4CAF50"
                                               Padding="8,4"
                                               CornerRadius="8"
                                               HasShadow="False"
                                               HorizontalOptions="End"
                                               IsVisible="{Binding ShowMyEventBadge}">
                                            <Label Text="ðŸŽ¯ ÐœÐ¾Ñ‘ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ" 
                                                   FontSize="10"
                                                   TextColor="White"
                                                   FontAttributes="Bold"/>
                                        </Frame>
                                    </Grid>

                                    <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾Ð± ÑƒÑ‡Ð°ÑÑ‚Ð¸Ð¸ -->
                                    <Label Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding EventTypeText}"
                                           FontSize="12"
                                           TextColor="Gray"
                                           IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, 
                                                             Path=BindingContext.SelectedTab,
                                                             Converter={x:StaticResource ShowArchiveInfoConverter}}"/>

                                    <!-- Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¸ -->
                                    <Label Grid.Row="5" Grid.Column="0" Grid.ColumnSpan="2"
                                           Text="{Binding ParticipantsDisplay}" 
                                           FontSize="12"
                                           TextColor="Gray"
                                           HorizontalOptions="End"/>

                                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹ -->
                                    <Grid Grid.Row="6" Grid.Column="0" Grid.ColumnSpan="2"
                                          ColumnDefinitions="*,Auto"
                                          IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, 
                                                             Path=BindingContext.SelectedTab,
                                                             Converter={x:StaticResource ShowActionsConverter}}">

                                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ñ…) -->
                                        <Button Grid.Column="0"
                                                Text="âœï¸ Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditEventCommand}"
                                                CommandParameter="{Binding Id}"
                                                BackgroundColor="Transparent"
                                                TextColor="#512BD4"
                                                BorderColor="#512BD4"
                                                BorderWidth="1"
                                                HeightRequest="35"
                                                Margin="0,0,5,0"
                                                CornerRadius="8"
                                                FontSize="12"
                                                IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectedTab, Converter={x:StaticResource ShowEditButtonConverter}}"/>

                                        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð²Ñ‹Ñ…Ð¾Ð´Ð° (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ñ) -->
                                        <Button Grid.Column="1"
                                                Text="ðŸš« Ð’Ñ‹Ð¹Ñ‚Ð¸"
                                                Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.LeaveEventCommand}"
                                                CommandParameter="{Binding Id}"
                                                BackgroundColor="#FF6B6B"
                                                TextColor="White"
                                                HeightRequest="35"
                                                Margin="5,0,0,0"
                                                CornerRadius="8"
                                                FontSize="12"
                                                IsVisible="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectedTab, Converter={x:StaticResource ShowLeaveButtonConverter}}"/>
                                    </Grid>
                                </Grid>
                            </Frame>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <ActivityIndicator Grid.Row="0" Grid.RowSpan="2"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           Color="#512BD4"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
    </Grid>
</ContentPage>