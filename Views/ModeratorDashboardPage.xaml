<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.ModeratorDashboardPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:Point_v1.Models"
             xmlns:converters="clr-namespace:Point_v1.Converters"
             Title="ÐŸÐ°Ð½ÐµÐ»ÑŒ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°">

    <ContentPage.Resources>
        <converters:ReportTypeConverter x:Key="ReportTypeConverter" />
        <converters:ReportStatusConverter x:Key="ReportStatusConverter" />
        <converters:ReportColorConverter x:Key="ReportColorConverter" />
        <converters:NegativeBooleanConverter x:Key="NegativeBooleanConverter" />
        <converters:PendingReportsColorConverter x:Key="PendingReportsColorConverter" />
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*,Auto">


        <!-- ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ -->
        <RefreshView Grid.Row="1" 
                     Command="{Binding RefreshCommand}"
                     IsRefreshing="{Binding IsLoading}">

            <ScrollView>
                <VerticalStackLayout Spacing="20" Padding="20">

                    <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐµ Ð¿Ñ€Ð°Ð² -->
                    <VerticalStackLayout Spacing="15" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center"
                                       IsVisible="{Binding IsModerator, Converter={x:StaticResource NegativeBooleanConverter}}">

                        <Label Text="ðŸ›¡ï¸" 
                               FontSize="40" 
                               HorizontalOptions="Center"/>

                        <Label Text="Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ð·Ð°Ð¿Ñ€ÐµÑ‰ÐµÐ½" 
                               FontSize="18"
                               FontAttributes="Bold"
                               HorizontalOptions="Center"/>

                        <Label Text="Ð£ Ð²Ð°Ñ Ð½ÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð¿Ñ€Ð°Ð² Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð¿Ð°Ð½ÐµÐ»Ð¸ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°" 
                               FontSize="14"
                               TextColor="Gray"
                               HorizontalOptions="Center"
                               HorizontalTextAlignment="Center"/>
                    </VerticalStackLayout>

                    <!-- Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð¼Ð¾Ð´ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð° -->
                    <VerticalStackLayout Spacing="20"
                                       IsVisible="{Binding IsModerator}">

                        <!-- Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° -->
                        <Frame Padding="20" 
                               CornerRadius="15" 
                               HasShadow="True"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">
                            <VerticalStackLayout Spacing="15">
                                <Label Text="ðŸ“Š Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ°" 
                                       FontSize="18"
                                       FontAttributes="Bold"/>

                                <Grid ColumnDefinitions="*,*" 
                                      RowDefinitions="Auto"
                                      RowSpacing="10"
                                      ColumnSpacing="10">

                                    <!-- ÐžÐ¶Ð¸Ð´Ð°ÑŽÑ‰Ð¸Ðµ Ð¶Ð°Ð»Ð¾Ð±Ñ‹ -->
                                    <Frame Grid.Row="0" Grid.Column="0"
                                           BackgroundColor="{Binding PendingReportsCount, Converter={x:StaticResource PendingReportsColorConverter}}"
                                           Padding="20"
                                           CornerRadius="12">
                                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                                            <Label Text="{Binding PendingReportsCount}" 
                                                   FontSize="28"
                                                   FontAttributes="Bold"
                                                   TextColor="White"
                                                   HorizontalOptions="Center"/>
                                            <Label Text="ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¶Ð°Ð»Ð¾Ð±" 
                                                   FontSize="13"
                                                   TextColor="White"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                    </Frame>

                                    <!-- Ð ÐµÑˆÐµÐ½Ð½Ñ‹Ðµ Ð¶Ð°Ð»Ð¾Ð±Ñ‹ -->
                                    <Frame Grid.Row="0" Grid.Column="1"
                                           BackgroundColor="{AppThemeBinding Light=#E8F5E8, Dark=#1B5E20}"
                                           Padding="20"
                                           CornerRadius="12">
                                        <VerticalStackLayout Spacing="8" HorizontalOptions="Center">
                                            <Label Text="{Binding ResolvedReportsCount}" 
                                                   FontSize="28"
                                                   FontAttributes="Bold"
                                                   TextColor="{AppThemeBinding Light=#2E7D32, Dark=#81C784}"
                                                   HorizontalOptions="Center"/>
                                            <Label Text="Ð ÐµÑˆÐµÐ½Ð¾ Ð¶Ð°Ð»Ð¾Ð±" 
                                                   FontSize="13"
                                                   TextColor="{AppThemeBinding Light=#2E7D32, Dark=#81C784}"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                    </Frame>
                                </Grid>

                                <!-- Ð•Ð´Ð¸Ð½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¶Ð°Ð»Ð¾Ð±Ð°Ð¼Ð¸ -->
                                <Button Text="ðŸ“‹ Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²ÑÐµÐ¼Ð¸ Ð¶Ð°Ð»Ð¾Ð±Ð°Ð¼Ð¸" 
                                        Command="{Binding ViewAllReportsCommand}"
                                        BackgroundColor="{AppThemeBinding Light=#512BD4, Dark=#512BD4}"
                                        TextColor="White"
                                        HeightRequest="45"
                                        CornerRadius="10"
                                        FontSize="14"
                                        FontAttributes="Bold"
                                        Margin="0,10,0,0"/>
                            </VerticalStackLayout>
                        </Frame>

                        <!-- ÐÐµÐ´Ð°Ð²Ð½Ð¸Ðµ Ð¶Ð°Ð»Ð¾Ð±Ñ‹ -->
                        <Frame Padding="20" 
                               CornerRadius="15" 
                               HasShadow="True"
                               BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}">
                            <VerticalStackLayout Spacing="15">
                                <!-- Ð£Ð‘Ð ÐÐ›Ð˜ Grid - Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº Ð±ÐµÐ· Ð½Ð°Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ -->
                                <Label Text="â° ÐÐµÐ´Ð°Ð²Ð½Ð¸Ðµ Ð¶Ð°Ð»Ð¾Ð±Ñ‹" 
                                       FontSize="16"
                                       FontAttributes="Bold"/>

                                <CollectionView ItemsSource="{Binding RecentReports}"
                                                SelectionMode="None"
                                                HeightRequest="250">

                                    <CollectionView.EmptyView>
                                        <VerticalStackLayout HorizontalOptions="Center" VerticalOptions="Center" Spacing="10" HeightRequest="200">
                                            <Label Text="âœ…" FontSize="40" HorizontalOptions="Center"/>
                                            <Label Text="ÐÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ñ… Ð¶Ð°Ð»Ð¾Ð±" 
                                                   FontSize="14"
                                                   TextColor="Gray"
                                                   HorizontalOptions="Center"/>
                                        </VerticalStackLayout>
                                    </CollectionView.EmptyView>

                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="models:Report">
                                            <Grid Padding="10,5">
                                                <Frame BackgroundColor="{Binding Status, Converter={x:StaticResource ReportColorConverter}}"
                                                       Padding="15"
                                                       CornerRadius="10"
                                                       HasShadow="True">

                                                    <Grid ColumnDefinitions="*,Auto" 
                                                          RowDefinitions="Auto,Auto,Auto"
                                                          RowSpacing="6">

                                                        <!-- Ð¢Ð¸Ð¿ Ð¶Ð°Ð»Ð¾Ð±Ñ‹ -->
                                                        <Label Grid.Row="0" Grid.Column="0"
                                                               Text="{Binding Type, Converter={x:StaticResource ReportTypeConverter}}"
                                                               FontSize="14"
                                                               FontAttributes="Bold"
                                                               LineBreakMode="TailTruncation"/>

                                                        <!-- Ð”Ð°Ñ‚Ð° -->
                                                        <Label Grid.Row="0" Grid.Column="1"
                                                               Text="{Binding CreatedAt, StringFormat='{0:dd.MM HH:mm}'}"
                                                               FontSize="11"
                                                               TextColor="Gray"
                                                               HorizontalOptions="End"/>

                                                        <!-- ID ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ -->
                                                        <Label Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                                               Text="{Binding TargetEventId, StringFormat='Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ: {0}'}"
                                                               FontSize="12"
                                                               TextColor="Gray"
                                                               LineBreakMode="TailTruncation"/>

                                                        <!-- Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ -->
                                                        <Grid Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                                              ColumnDefinitions="*,Auto"
                                                              ColumnSpacing="10"
                                                              Margin="0,5,0,0">
                                                            <Button Grid.Column="0"
                                                                    Text="ðŸ” Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ"
                                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ResolveReportCommand}"
                                                                    CommandParameter="{Binding .}"
                                                                    BackgroundColor="{AppThemeBinding Light=#512BD4, Dark=#512BD4}"
                                                                    TextColor="White"
                                                                    HeightRequest="32"
                                                                    CornerRadius="8"
                                                                    FontSize="12"/>
                                                            
                                                            <Button Grid.Column="1"
                                                                    Text="ðŸ‘ï¸ Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ"
                                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.ViewEventCommand}"
                                                                    CommandParameter="{Binding TargetEventId}"
                                                                    BackgroundColor="Transparent"
                                                                    TextColor="{AppThemeBinding Light=#512BD4, Dark=#9880e5}"
                                                                    BorderColor="{AppThemeBinding Light=#512BD4, Dark=#9880e5}"
                                                                    BorderWidth="1"
                                                                    HeightRequest="32"
                                                                    CornerRadius="8"
                                                                    FontSize="12"/>
                                                        </Grid>
                                                    </Grid>
                                                </Frame>
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </Frame>

                    </VerticalStackLayout>
                </VerticalStackLayout>
            </ScrollView>
        </RefreshView>

        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <ActivityIndicator Grid.Row="0" Grid.RowSpan="2"
                           IsRunning="{Binding IsLoading}"
                           IsVisible="{Binding IsLoading}"
                           Color="#512BD4"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>

    </Grid>
</ContentPage>
