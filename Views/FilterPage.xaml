<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.FilterPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Фильтры"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1C1C1E}">

    <ScrollView>
        <VerticalStackLayout Spacing="0" Padding="0">

            <!-- Шапка -->
            <Frame BackgroundColor="#512BD4"
                   Padding="20,60,20,20"
                   CornerRadius="0"
                   HasShadow="True">
                <Grid ColumnDefinitions="Auto,*,Auto">
                    <Button Grid.Column="0"
                            Text="✕"
                            Clicked="OnCloseClicked"
                            BackgroundColor="Transparent"
                            TextColor="White"
                            FontSize="18"
                            WidthRequest="40"
                            HeightRequest="40"/>

                    <Label Grid.Column="1"
                           Text="Фильтры событий"
                           TextColor="White"
                           FontSize="20"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>
                </Grid>
            </Frame>

            <!-- Основной контент -->
            <VerticalStackLayout Spacing="0" Padding="20" Margin="0,10,0,0">

                <!-- Категория -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                       Padding="15"
                       CornerRadius="12"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Категория" 
                               FontSize="16" 
                               FontAttributes="Bold"/>

                        <Picker Title="Выберите категорию"
                                ItemsSource="{Binding AvailableCategories}"
                                SelectedItem="{Binding SelectedCategory}"
                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                                TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                HeightRequest="45"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Дата -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                       Padding="15"
                       CornerRadius="12"
                       HasShadow="True"
                       Margin="0,15,0,0">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Дата события" 
                               FontSize="16" 
                               FontAttributes="Bold"/>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <DatePicker Grid.Column="0"
                                        Date="{Binding SelectedDate}"
                                        BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                                        HeightRequest="45"/>

                            <Button Grid.Column="1"
                                    Text="Очистить"
                                    Command="{Binding ClearDateCommand}"
                                    BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#444}"
                                    TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                    HeightRequest="45"
                                    CornerRadius="8"/>
                        </Grid>

                        <!-- Быстрые даты -->
                        <FlexLayout BindableLayout.ItemsSource="{Binding QuickDates}"
                                    Wrap="Wrap"
                                    JustifyContent="Start">
                            <BindableLayout.ItemTemplate>
                                <DataTemplate>
                                    <Button Text="{Binding Name}"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.SelectQuickDateCommand}"
                                            CommandParameter="{Binding}"
                                            BackgroundColor="{AppThemeBinding Light=#F0F0F0, Dark=#3A3A3C}"
                                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                            Margin="0,0,10,10"
                                            Padding="15,8"
                                            CornerRadius="20"
                                            HeightRequest="35"/>
                                </DataTemplate>
                            </BindableLayout.ItemTemplate>
                        </FlexLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Участники -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                       Padding="15"
                       CornerRadius="12"
                       HasShadow="True"
                       Margin="0,15,0,0">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Участники" 
                               FontSize="16" 
                               FontAttributes="Bold"/>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                            <Picker Grid.Column="0"
                                    Title="Статус записи"
                                    ItemsSource="{Binding ParticipationStatuses}"
                                    SelectedItem="{Binding SelectedParticipationStatus}"
                                    BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                                    TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                    HeightRequest="45"/>

                            <Picker Grid.Column="1"
                                    Title="Кол-во участников"
                                    ItemsSource="{Binding ParticipantCounts}"
                                    SelectedItem="{Binding SelectedParticipantCount}"
                                    BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                                    TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                    HeightRequest="45"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Радиус поиска -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                       Padding="15"
                       CornerRadius="12"
                       HasShadow="True"
                       Margin="0,15,0,0">
                    <VerticalStackLayout Spacing="10">
                        <Grid ColumnDefinitions="*,Auto">
                            <Label Grid.Column="0"
                                   Text="Радиус поиска" 
                                   FontSize="16" 
                                   FontAttributes="Bold"/>

                            <Label Grid.Column="1"
                                   Text="{Binding SearchRadius, StringFormat='{0} км'}"
                                   FontSize="14"
                                   TextColor="#512BD4"
                                   FontAttributes="Bold"/>
                        </Grid>

                        <Slider Minimum="1"
                                Maximum="50"
                                Value="{Binding SearchRadius}"
                                MinimumTrackColor="#512BD4"
                                MaximumTrackColor="{AppThemeBinding Light=#E0E0E0, Dark=#444}"
                                ThumbColor="#512BD4"/>

                        <Grid ColumnDefinitions="*,*,*,*">
                            <Label Grid.Column="0" Text="1 км" FontSize="12" HorizontalOptions="Start"/>
                            <Label Grid.Column="1" Text="10 км" FontSize="12" HorizontalOptions="Center"/>
                            <Label Grid.Column="2" Text="25 км" FontSize="12" HorizontalOptions="Center"/>
                            <Label Grid.Column="3" Text="50 км" FontSize="12" HorizontalOptions="End"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Сортировка -->
                <Frame BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                       Padding="15"
                       CornerRadius="12"
                       HasShadow="True"
                       Margin="0,15,0,0">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="Сортировка" 
                               FontSize="16" 
                               FontAttributes="Bold"/>

                        <Picker Title="Порядок сортировки"
                                ItemsSource="{Binding SortOptions}"
                                SelectedItem="{Binding SelectedSortOption}"
                                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#3C3C3E}"
                                TextColor="{AppThemeBinding Light=Black, Dark=White}"
                                HeightRequest="45"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Активные фильтры -->
                <Frame BackgroundColor="#E8F5E8"
                       BorderColor="#4CAF50"
                       Padding="15"
                       CornerRadius="12"
                       Margin="0,20,0,0"
                       IsVisible="{Binding HasActiveFilters}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Активные фильтры:" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="#2E7D32"/>

                        <CollectionView ItemsSource="{Binding ActiveFilters}"
                                        HeightRequest="60"
                                        SelectionMode="None">
                            <CollectionView.ItemsLayout>
                                <LinearItemsLayout Orientation="Horizontal" ItemSpacing="10"/>
                            </CollectionView.ItemsLayout>
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame BackgroundColor="#4CAF50"
                                           Padding="10,5"
                                           CornerRadius="15">
                                        <Label Text="{Binding .}"
                                               TextColor="White"
                                               FontSize="12"/>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Кнопки действий -->
                <Grid ColumnDefinitions="*,*" 
                      ColumnSpacing="15"
                      Margin="0,30,0,20">

                    <Button Grid.Column="0"
                            Text="Сбросить всё"
                            Command="{Binding ResetFiltersCommand}"
                            BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#444}"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                            HeightRequest="50"
                            CornerRadius="12"
                            FontSize="16"/>

                    <Button Grid.Column="1"
                            Text="Применить"
                            Command="{Binding ApplyFiltersCommand}"
                            BackgroundColor="#512BD4"
                            TextColor="White"
                            HeightRequest="50"
                            CornerRadius="12"
                            FontSize="16"
                            FontAttributes="Bold"/>
                </Grid>

            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>