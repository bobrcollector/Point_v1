<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="Point_v1.Views.CreateEventPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:Point_v1.Converters"
             Title="Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ"
             BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#1C1C1E}">

    <ScrollView>
        <VerticalStackLayout Spacing="0">

            <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
            <Frame BackgroundColor="#512BD4"
                   Padding="25,40"
                   CornerRadius="0"
                   HasShadow="True">
                <VerticalStackLayout Spacing="10">
                    <Label Text="ðŸŽ‰" 
                           FontSize="30"
                           HorizontalOptions="Center"/>

                    <Label Text="Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ" 
                           FontSize="24" 
                           TextColor="White"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>

                    <Label Text="Ð Ð°ÑÑÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¾ Ð²Ð°ÑˆÐµÐ¼ Ð¼ÐµÑ€Ð¾Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ð¸" 
                           FontSize="14" 
                           TextColor="#DFD8F7"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Ð¤Ð¾Ñ€Ð¼Ð° -->
            <VerticalStackLayout Spacing="20" Padding="25" BackgroundColor="Transparent">

                <!-- Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… -->
                <Label Text="{Binding ErrorMessage}" 
                       IsVisible="{Binding ErrorMessage, Converter={converters:IsNotNullOrEmptyConverter}}"
                       TextColor="#D32F2F" 
                       FontSize="14"
                       HorizontalOptions="Center"
                       Padding="15,10"
                       HorizontalTextAlignment="Center"
                       Margin="0,0,0,10"/>

                <!-- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ *" 
                           FontSize="14" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#333, Dark=White}"/>
                    <Entry Placeholder="ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: Ð’ÐµÑ‡ÐµÑ€ Ð½Ð°ÑÑ‚Ð¾Ð»ÑŒÐ½Ñ‹Ñ… Ð¸Ð³Ñ€" 
                           Text="{Binding Title}"
                           BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}"
                           HeightRequest="50"/>
                </VerticalStackLayout>

                <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ *" 
                           FontSize="14" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#333, Dark=White}"/>
                    <Editor Placeholder="ÐžÐ¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½ÐµÐµ..." 
                            Text="{Binding Description}"
                            BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                            HeightRequest="120"
                            AutoSize="TextChanges"/>
                </VerticalStackLayout>

                <!-- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ *" 
                           FontSize="14" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#333, Dark=White}"/>
                    <Picker Title="Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ..." 
                            ItemsSource="{Binding Interests}"
                            ItemDisplayBinding="{Binding Name}"
                            SelectedItem="{Binding SelectedInterest}"
                            BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                            HeightRequest="50"/>
                </VerticalStackLayout>

                <!-- Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                    <VerticalStackLayout Grid.Column="0" Spacing="8">
                        <Label Text="Ð”Ð°Ñ‚Ð° *" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#333, Dark=White}"/>
                        <DatePicker Date="{Binding EventDate}"
                                    MinimumDate="{Binding MinDate}"
                                    MaximumDate="{Binding MaxDate}"
                                    BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"/>
                    </VerticalStackLayout>

                    <VerticalStackLayout Grid.Column="1" Spacing="8">
                        <Label Text="Ð’Ñ€ÐµÐ¼Ñ *" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#333, Dark=White}"/>
                        <TimePicker Time="{Binding EventTime}"
                                    BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"/>
                    </VerticalStackLayout>
                </Grid>

                <!-- ÐœÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="ÐœÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ *" 
           FontSize="14" 
           FontAttributes="Bold"
           TextColor="{AppThemeBinding Light=#333, Dark=White}"/>

                    <!-- ÐŸÐ¾Ð»Ðµ Ð²Ð²Ð¾Ð´Ð° Ð°Ð´Ñ€ÐµÑÐ° -->
                    <Entry Placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð°Ð´Ñ€ÐµÑ Ð¸Ð»Ð¸ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¼ÐµÑÑ‚Ð°..." 
           Text="{Binding Address}"
           BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
           TextColor="{AppThemeBinding Light=Black, Dark=White}"
           HeightRequest="50"
           x:Name="AddressEntry"/>

                    <!-- Ð’Ñ‹Ð¿Ð°Ð´Ð°ÑŽÑ‰Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð¾Ð´ÑÐºÐ°Ð·Ð¾Ðº -->
                    <Frame IsVisible="{Binding AddressSuggestions.Count, Converter={converters:IsNotNullOrEmptyConverter}}"
           BackgroundColor="{AppThemeBinding Light=White, Dark=#2C2C2E}"
           BorderColor="{AppThemeBinding Light=#E0E0E0, Dark=#444}"
           Padding="0"
           CornerRadius="5"
           HasShadow="True">

                        <CollectionView HeightRequest="150"
                        SelectionMode="Single"
                        ItemsSource="{Binding AddressSuggestions}"
                        SelectedItem="{Binding SelectedSuggestion}">

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid Padding="15,12" HeightRequest="44">
                                        <Label Text="{Binding .}"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=#333, Dark=White}"
                               LineBreakMode="TailTruncation"
                               VerticalOptions="Center"/>

                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup x:Name="CommonStates">
                                                <VisualState x:Name="Normal">
                                                    <VisualState.Setters>
                                                        <Setter Property="BackgroundColor" Value="Transparent"/>
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Property="BackgroundColor" Value="#DFD8F7"/>
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Frame>

                    <!-- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð²Ñ‹Ð±Ð¾Ñ€Ð° -->
                    <Label Text="{Binding SelectionStatus}"
           IsVisible="{Binding SelectionStatus, Converter={converters:IsNotNullOrEmptyConverter}}"
           FontSize="12"
           TextColor="#512BD4"
           FontAttributes="Bold"
           HorizontalOptions="Center"/>

                    <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð°Ð´Ñ€ÐµÑÐ¾Ð¼ -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10" Margin="0,10,0,0">
                        <Button Grid.Column="0"
                Text="ðŸŽ¯ ÐœÐ¾Ðµ Ð¼ÐµÑÑ‚Ð¾Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ"
                Command="{Binding GetCurrentLocationCommand}"
                BackgroundColor="#DFD8F7"
                TextColor="#512BD4"
                FontSize="12"
                FontAttributes="Bold"
                HeightRequest="40"
                CornerRadius="20"/>

                        <Button Grid.Column="1"
                Text="ðŸ“Œ ÐÐ° ÐºÐ°Ñ€Ñ‚Ðµ"
                Command="{Binding OpenMapSearchCommand}"
                BackgroundColor="#E3F2FD"
                TextColor="#1976D2"
                FontSize="12"
                FontAttributes="Bold"
                HeightRequest="40"
                CornerRadius="20"/>
                    </Grid>

                    <!-- ÐŸÐ¾Ð´ÑÐºÐ°Ð·ÐºÐ° -->
                    <Label Text="ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ð²Ð²Ð¾Ð´Ð¸Ñ‚ÑŒ Ð°Ð´Ñ€ÐµÑ (Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°)"
           FontSize="11"
           TextColor="Gray"
           HorizontalOptions="Center"/>

                    <!-- Ð¡ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ Ð¿Ð¾Ð»Ñ Ð´Ð»Ñ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚ -->
                    <Entry Text="{Binding Latitude}" IsVisible="False"/>
                    <Entry Text="{Binding Longitude}" IsVisible="False"/>
                </VerticalStackLayout>

                <!-- ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²" 
                           FontSize="14" 
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#333, Dark=White}"/>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <VerticalStackLayout Grid.Column="0" Spacing="5">
                            <Label Text="{Binding MaxParticipants, StringFormat='{0} ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²'}"
                                   FontSize="16"
                                   FontAttributes="Bold"
                                   TextColor="#512BD4"
                                   HorizontalOptions="Center"/>

                            <Label Text="Ð¢ÐµÐºÑƒÑ‰ÐµÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ" 
                                   FontSize="12"
                                   TextColor="Gray"
                                   HorizontalOptions="Center"/>
                        </VerticalStackLayout>

                        <Stepper Grid.Column="1"
                                 Value="{Binding MaxParticipants}"
                                 Minimum="2"
                                 Maximum="50"
                                 Increment="1"
                                 HorizontalOptions="Center"
                                 VerticalOptions="Center"/>
                    </Grid>
                </VerticalStackLayout>

                <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,30">
                    <Button Grid.Column="0" 
                            Text="ÐžÑ‚Ð¼ÐµÐ½Ð°" 
                            Command="{Binding CancelCommand}"
                            BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#444}"
                            TextColor="{AppThemeBinding Light=Black, Dark=White}"
                            HeightRequest="50"
                            CornerRadius="10"/>

                    <Button Grid.Column="1" 
                            Text="Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ" 
                            Command="{Binding CreateEventCommand}"
                            BackgroundColor="#512BD4"
                            TextColor="White"
                            FontAttributes="Bold"
                            HeightRequest="50"
                            CornerRadius="10"/>
                </Grid>

                <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
                <ActivityIndicator IsVisible="{Binding IsBusy}" 
                                 IsRunning="{Binding IsBusy}"
                                 Color="#512BD4"
                                 HorizontalOptions="Center"
                                 HeightRequest="50"/>

            </VerticalStackLayout>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>